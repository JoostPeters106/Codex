<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tournament</title>
    <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto+Condensed:ital,wght@0,100..900;1,100..900&display=swap');
    </style>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <header class="site-header">
        <h1>Tournament {{ t_id }}</h1>
        <img src="{{ url_for('static', filename='Dutch_darts_v2.png') }}" alt="Logo">
    </header>
    <form id="reset-form" action="{{ url_for('reset') }}" method="post" style="padding-bottom: 1em;">
        <button id="reset-btn" type="button" class="styled-button secondary-button">Go back to start</button>
    </form>

    <div id="confirm-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5);">
        <div style="background:#fff; padding:1em; border-radius:5px; width:200px; margin:20% auto; text-align:center; color:#000;">
            <p>Are you sure?</p>
            <button id="confirm-yes" class="styled-button danger-button">Yes</button>
            <button id="confirm-no" class="styled-button secondary-button">No</button>
        </div>
    </div>


    <div class="tournament-layout">
        <div class="tournament-sidebar">
            <section class="players card">
                <h2>Players</h2>
                <ul>
                    {% for p in players %}
                    <li>{{ p }}</li>
                    {% endfor %}
                </ul>
            </section>

            <section class="standings card">
                <h2>Standings</h2>
                <table>
                    <tr><th>Player</th><th>Points</th><th>GD</th></tr>
                    {% for s in standings_a %}
                    <tr><td>{{ s.name }}</td><td>{{ s.points }}</td><td>{{ s.gd }}</td></tr>
                    {% endfor %}
                </table>
            </section>
        </div>

        <div class="matches card">
            <h2>Group Stage</h2>
            {% set ns = namespace(idx=0) %}
            {% for round in schedule_rounds %}
            <h3 style="text-align: left;">Round {{ loop.index }}</h3>
            <table>
                <tr><th>Match</th><th>Score</th></tr>
                {% for m in round %}
                <tr>
                    <td>{{ m.p1 }} vs {{ m.p2 }}</td>
                    <td>
                        {% if session.admin_logged_in %}
                        <form action="{{ url_for('record_score', t_id=t_id, group='A', index=ns.idx) }}" method="post" style="display:inline">
                            <input type="number" name="score1" min="0" required style="width:3em;" value="{{ m.score1 if m.score1 is not none }}">
                            -
                            <input type="number" name="score2" min="0" required style="width:3em;" value="{{ m.score2 if m.score2 is not none }}">
                            <button type="submit" class="styled-button primary-button">Save</button>
                        </form>
                        {% else %}
                            {{ m.score1 if m.score1 is not none else '' }} - {{ m.score2 if m.score2 is not none else '' }}
                        {% endif %}
                    </td>
                </tr>
                {% set ns.idx = ns.idx + 1 %}
                {% endfor %}
            </table>
            {% endfor %}
        </div>
    </div>

    <a href="{{ url_for('knockout_view', t_id=t_id) }}" class="styled-button primary-button" style="margin-top:1em; display:inline-block;">Go to Knockout</a>

    <script>
        const resetBtn = document.getElementById('reset-btn');
        const modal = document.getElementById('confirm-modal');
        const yesBtn = document.getElementById('confirm-yes');
        const noBtn = document.getElementById('confirm-no');

        resetBtn.addEventListener('click', () => {
            modal.style.display = 'block';
        });
        yesBtn.addEventListener('click', () => {
            document.getElementById('reset-form').submit();
        });
        noBtn.addEventListener('click', () => {
            modal.style.display = 'none';
        });
    </script>
</body>
</html>